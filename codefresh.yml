version: '1.0'
steps:
  deploy_to_swarm:
    image: ncodefresh/remote-docker:ssh-tunnel
    working_directory: ${{main_clone}}
    commands:
      - rdocker ${{RDOCKER_HOST}} ${{LOCAL_PORT}} docker stack deploy --compose-file docker-stack.yml ${{STACK_NAME}}
    environment:
      - SSH_KEY=${{SSH_KEY}}
      - SSH_PORT=${{SSH_PORT}}
    when:
      branch:
        only:
          - ssh-tunnel
